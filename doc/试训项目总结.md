## 实训项目架构

### gateway&netty
*	主要功能: 功能上他根据对称的解析方式把客户端的数据解析成业务数据,然后封装成任务提交到项目中,具体方式可以是字节数组反序列成对象等形式。
*	高可用: 它在处理请求上的高效的实现机制很重要，例如它的Reactor模型，异步模型，，0拷贝等机制的实现原理。
*	网络消息处理:所以一些网络消息处理要注重一下细节，例如粘包处理时,高频率的尝试性行为，内存申请要把控一下,同时要能治理自己的连接。
*	派发器:通过提交任务到账号线程,反射具体service的方法.在反射这里可以做厚点，加上权限校验等机制，具体service中就不用重复去写功能开启检查等逻辑了

### 缓存与db
*	有些信息变动频率很高，但是没有必要立刻入库保存，一方面db压力会比较大，另一方面从db拉数据还要经过各种io 速度会比较慢，同时我们用序列化方式存储业务模块数据，这里也是有损耗的。所以需要一个内存的缓存。这个缓存模块至少要支持缓存失效，不能让这个模块无限膨胀，占据大部分内存。

### 事件系统
*	eventBus:这里还是很薄的一个模块，本质上是一个map，也是走反射调用的。最好做厚一点，能达到这样的效果:push一个event，能自己决定去哪些线程执行相对应的逻辑。

### 静态资源
静态资源:支持解析csv成java对象，同时可以二次解析一些复杂的对象字段。项目中的做得比较简单，没有提供热更，多重索引，命中检查等功能。

### 其他架构
*	spring:委托spring管理所有模块，同时spring很多功能后续拓展使用起来会方便一点。
*	线程模型 [账号线程，地图线程，其他线程] 用某种hash方式印射到具体线程上，一些线程不安全数据模块的用这种方式规避掉风险，如果线程之间业务需要调用，暂时可以通过命令方式去做。注意一下线程池的设计，拒绝策略等细节。
*	调度服务:主要是一些周期和cron调度，目前使用需要注意的地方[调度服务资源设置,调度任务command要对应到具体线程执行,调度并行]

### 游戏内部实现思考
#### 属性设计优化
*	目前的属性计算是通过属性type将其关联起来的,然后用属性计算器决定属性的计算顺序.目前就是默认的计算器,直接写死在type里.然后计算逻辑就按这个流程走的.
思考过一种树形的计算流程,用基本属性作为根节点,然后用一个double数字做映射关系到下一个属性节点,然后依次按照这种顺序再去迭代,模块和模块之前可以隔离开,但是又可以通过一样的映射关系到达同一个水平级别. HP[0.001] 指定关系[0.01] 映射到传世头盔[0.011] 再指定关系[0.1] 映射到雷霆头盔[0.111] 策划要三次分别计算的数值,直接按照关系去找对应的树节点,即使是非常恶心的需求,也可以通过映射关系来解决.但是内存上会占用比较多的节点.

#### buff生效机制
*	无论是地图一直起一个任务跑还是别的线程负责调度,都会很不灵活. 可以在一场战斗中维护一个时钟系统,0.1s 0.3s 1s这些特定时间点由外部发起调度,buff注册的时候可以根据某种策略注册到相近的时钟系统上,然后时钟调度来临去执行他.本质上和0.1s疯狂调度没有区别,但是如果buff都是1s 2s这种调度,0.1s的map事实上是个空集合,不需要走无用的触发逻辑.

#### 锁的应用
*	对于锁还是要了解一下jvm的模型才知道它的实现机制和表现效果,然后就是不同需求去选择对应的机制.
*	对于一些公共的模块,变动频繁,可能会影响到玩家线程性能的模块,最好是再单独抽一个现成出来专门处理这快业务逻辑,屏蔽了麻烦的线程同步问题.
*	对于排行榜,可以这么改:推送数据用读锁,不处理map的容量问题,然后调度线程上写锁,清理完之后再释放.

### 个人总结
#### 编码规范
*	编码规范不仅是代码命令,驼峰,魔法值这种地方.模块分包,动态静态数据分离,模块边界这些难以分辨的也比较难以处理,如果没把控好,后期维护会很麻烦.

#### 编程思想
*	个人写代码习惯有了很大改变,用枚举,常量之类的语法规避掉重复的代码.对于需要拓展的模块,公共部分如何用多态联系在一起,用子类去完成特殊的需求.

#### 知识储备
*	最多的地方就是java知识储备变多.从最底层的netty到游戏中的业务,大多数的点都自己用代码实现了一遍,之前只是了解原理,没有手动去写,所以没有发现 - 解决问题的这个过程.

#### 个人经验
*	[清楚需求再编程,不然做的事没有意义]--[实现一个功能,自己先评估执行力和机制的契合程度,把功能弄出来是首要]--[遇到问题解决不了,及时沟通]

#### 业务细节
*	游戏后台逻辑还是有很大的不同,相对于其他的后台,游戏的逻辑比较复杂,模块比较多,模块可能藏的坑比较深,例如要防止玩家利用bug刷奖,敏感数据记录日志,模块内业务前后统一